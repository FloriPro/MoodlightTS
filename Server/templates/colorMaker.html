<!DOCTYPE html>
<html lang="de">

<head>
    <title>Color Maker | MoodlightTS</title>
    <style>
        @font-face {
            font-family: 'msyi';
            src: url('/msyi.ttf');
        }

        .grayed {
            color: lightgray;
        }
    </style>

    <!--jquery-->
    <script src="/jquery-3.6.0.min.js" type="text/javascript"></script>

    <!--spectrunm-->
    <script src="/spectrum.js" type="text/javascript"></script>
    <link rel="stylesheet" type="text/css" href="/spectrum.css">
</head>

<body style="font-family: msyi;">
    <h1>Color Maker</h1>
    <div id="menu">
        <a href="/ownDesigns">Deine Designs</a><br>
        <button
            onclick="load(colors);document.getElementById('edit').style.display='';document.getElementById('menu').style.display='none';">Neu</button>
        <div id="menuElements">

        </div>
    </div>
    <div id="edit" style="display:none">
        <button
            onclick="document.getElementById('edit').style.display='none';document.getElementById('menu').style.display='';">Menu</button>
        <button onclick="load(JSON.parse(prompt('colorJson')));">import</button>
        <div style="display: flex;">
            <table>
                <tbody id="colors">
                </tbody>
            </table>
            <div>
                <textarea id="out" rows="30" cols="100">loading... I hope :)</textarea>
            </div>
        </div>
        <div id="loginStatement" style="width: 100%; background-color: red;display: none;">
            <h2 style="font-size: 40px;">Du bist nich angemeldet! Um Styles auf dem Server zu speichern musst du dich <a
                    href="/google/loginReturn?redirect=/colorMaker">anmelden</a>.</h2>
        </div>
        <button onclick="upload();">Design an Server Schicken</button>
    </div>
</body>

<script>
    let unused = ["backgroundPoints"]
    let colors = { "background": "#fcfcfc", "backgroundPoints": "#646464", "blockArgBackground": "#ffffff", "blueBlock": "#0082ff", "blueBlockAccent": "#0056aa", "YellowBlock": "#ffd000", "YellowBlockAccent": "#aa8a00", "PurpleBlock": "#d900ff", "PurpleBlockAccent": "#9000aa", "MoveBlockShaddow": "#b0b0b0", "EditMenu": "#d0f7e9", "EditMenuAccent": "#7bc9ac", "NormalText": "#000000", "MenuButtons": "#000000", "MenuBackground": "#000000", "MenuText": "#ffffff", "settingsBoolTrue": "#00ff00", "settingsBoolFalse": "#ff0000", "settingsSelMouseOver": "#d2d2d2", "settingsSelStandard": "#dcdcdc", "settingsSelSelected": "#c8c8c8", "backgroundBlur": "#000000", "settingsBackground": "#ffffff", "settingsBackgroundHighlight": "#f0f0f0", "questionRedBackgroundBlur": "#960000", "questionBackground": "#aaaaaa", "objectSidebarBlur": "#c0c0c0", "ProjectName": "#4287f5" };
    let colorsK = Object.keys(colors);
    load(colors);

    let l = localStorage.getItem("!designs");
    let d = JSON.parse(l);
    let a = {};
    let dK = Object.keys(d);

    function upload() {
        update()
        $.ajax({
            type: "POST",
            url: "/api/v0/uploadStyle",
            data: JSON.stringify([document.getElementById("out").value, prompt("Name:")]),
            success: function (e) {
                if (e != "ok") {
                    alert(e)
                } else {
                    alert("Hochgeladen")
                }
            }
        }).fail(function (e) {
            alert("UPDATE FAILED: Error code " + e.status);
        });
    }
    function load(colors) {
        console.log(colors);
        document.querySelector("#colors").innerHTML = "";

        var colorsK = Object.keys(colors);
        for (var x = 0; x < colorsK.length; x++) {
            var d = "";
            if (!unused.indexOf(colorsK[x])) { d = "grayed" }
            document.querySelector("#colors").innerHTML += `
            <tr class="color `+ d + `">
                <td>
                    <h3>`+ colorsK[x] + `:</h3>
                </td>
                <td>
                    <input onchange="update();" type="color" id="`+ x + `" value="` + colors[colorsK[x]] + `"/>
                </td>
            </tr>
            `;
        }
        update()
    }
    function update() {
        var out = { ...colors };
        for (var x = 0; x < colorsK.length; x++) {
            out[colorsK[x]] = document.getElementById(x).value;
        }
        document.getElementById("out").value = JSON.stringify(out);
    }
    function testLogin() {
        $.ajax({
            type: "POST",
            url: "/api/v0/checkLogin",
            success: function (e) {
                if (e[0] == "t") {
                    document.getElementById("loginStatement").style.display = "none";
                } else {
                    document.getElementById("loginStatement").style.display = "";
                }
            }
        }).fail(function (e) {
            settingsInfo["Anmelde Status"] = "FEHLER";
            alert("keine verbindung!")
            staticElementsData["Anmelde Status"] = undefined;
        });
    }

    function loadS(x) {
        document.getElementById('edit').style.display = '';
        document.getElementById('menu').style.display = 'none';
        load(JSON.parse(d[x]))
    }

    setTimeout(testLogin, 60000)
    testLogin()
    for (var x = 0; x < dK.length; x++) {
        document.getElementById("menuElements").innerHTML += `<p onclick="loadS('` + dK[x] + `')">` + dK[x] + `</p>`;
    }

</script>

</html>